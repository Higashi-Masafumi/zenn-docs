---
title: "å‹å®‰å…¨ã§é«˜é€Ÿé–‹ç™ºï¼æœ€æ–°ç‰ˆNotion APIå¯¾å¿œPython SDKã€Œnotion-py-clientã€ã®ç´¹ä»‹"
emoji: "ğŸ““"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Notion", "Python", "API", "TypeScript", "SDK"]
published: false
---

# ã¯ã˜ã‚ã«

æ ªå¼ä¼šç¤¾neoAIã§AIã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã«å‚åŠ ã—ã¦ã„ã‚‹ã€æ± çœŸå²ã§ã™ã€‚

å¼Šç¤¾ã§ã¯å–å¼•ã‚„è«‹æ±‚æ›¸ãªã©ã®å–¶æ¥­ãƒ‡ãƒ¼ã‚¿ã‚„ãƒŠãƒ¬ãƒƒã‚¸ã‚’å…¨ã¦Notionã«é›†ç´„ã—ã¦ç®¡ç†ã—ã¦ãŠã‚Šã€ç‰¹ã«å–¶æ¥­é–¢é€£ã®ãƒ‡ãƒ¼ã‚¿ã¯Notionã®[Database](https://www.notion.com/ja/help/intro-to-databases)ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

ä»Šå›ã¯Notionä¸Šã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã“ã¨ã§ã€æ¥­å‹™ã‚’åŠ¹ç‡åŒ–ã—ãŸéš›ã«é–‹ç™ºã—ãŸSDKã§ã‚ã‚‹[notion-py-client](https://higashi-masafumi.github.io/notion-py/)ã«ã¤ã„ã¦ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚

https://pypi.org/project/notion-py-client/

## ã“ã®è¨˜äº‹ã®å‰æã¨ã‚´ãƒ¼ãƒ«

- å‰æ: Notion API ã‚’ã€ŒPythonã€ã‹ã‚‰æœ¬ç•ªé‹ç”¨ãƒ¬ãƒ™ãƒ«ã§æ‰±ã„ãŸã„é–‹ç™ºè€…å‘ã‘ã®è¨˜äº‹ã§ã™ã€‚
- èª²é¡Œ: TypeScript ã«ã¯å…¬å¼ SDK ãŒã‚ã‚‹ä¸€æ–¹ã€Python ã«ã¯å‹å®‰å…¨ãª SDK ãŒå­˜åœ¨ã›ãšã€è£œå®Œãƒ»å‹ãƒã‚§ãƒƒã‚¯ãƒ»ä¿å®ˆæ€§ã«ç—›ã¿ãŒã‚ã‚‹ã“ã¨ã€‚
- è§£æ±º: ãã®ã‚®ãƒ£ãƒƒãƒ—ã‚’åŸ‹ã‚ã‚‹ãŸã‚ã® Python å‘ã‘ SDKã€Œnotion-py-clientã€ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
- ã‚´ãƒ¼ãƒ«: å‹å®‰å…¨ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹/ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€å¼·åŠ›ãªè£œå®Œã€è–„ã„ORMãƒ˜ãƒ«ãƒ‘ãƒ¼ã«ã‚ˆã‚‹å®Ÿè£…é€Ÿåº¦ã¨ä¿å®ˆæ€§ã®ä¸¡ç«‹ã€‚

## ã“ã‚“ãªèª²é¡Œã€ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

- `page["properties"]["Title"]["title"][0]["plain_text"]` ã®ã‚ˆã†ãªæ·±ã„ãƒã‚¹ãƒˆã«æ¯å›æ‚©ã‚€
- ã©ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ nullable ã‹æ¯å›ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’é–‹ã„ã¦ç¢ºèªã—ã¦ã„ã‚‹
- `dict[str, Any]` ã ã‚‰ã‘ã§è£œå®ŒãŒåŠ¹ã‹ãšã€typo ã‚„ `KeyError` ãŒåŸ‹ã‚‚ã‚Œã‚‹
- ãƒ•ã‚£ãƒ«ã‚¿ã‚„ã‚½ãƒ¼ãƒˆã®JSONã‚’æ›¸ã„ã¦ã¯è©¦ã—ç›´ã™åå¾©ãŒã¤ã‚‰ã„
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚„ 429ï¼ˆRate Limitï¼‰ã®ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã‚’æ¯å›æ‰‹æ›¸ãã—ã¦ã„ã‚‹
- Relation / Multi-Select / Rollup / Formula ã®å–ã‚Šå›ã—ã§å®Ÿè£…ãŒå£Šã‚ŒãŒã¡
- æ—¥ä»˜ã¨ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å¾€å¾©å¤‰æ›ã§ãƒã‚°ãŒå‡ºã‚„ã™ã„
- Notionå´ã®ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã‚„ API ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®è¿½éšãŒå¾Œæ‰‹ã«å›ã‚‹

notion-py-client ã¯ã€Python ã‹ã‚‰ Notion API ã‚’æ‰±ã†éš›ã®ã€Œå‹ä¸åœ¨ã€ã€Œå®Ÿè£…è² è·ã€ã€Œé‹ç”¨è¿½éšã€ã®ç—›ã¿ã‚’ã¾ã¨ã‚ã¦æ¸›ã‚‰ã—ã€å‹å®‰å…¨ã§ç´ æ—©ãå®Ÿè£…ã§ãã‚‹é–‹ç™ºä½“é¨“ã‚’ç›®æŒ‡ã—ã¦ä½œã‚Šã¾ã—ãŸã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã§å°å…¥ã§ãã¾ã™ã€‚

- pip

```bash
pip install notion-py-client
```

- uv

```bash
uv add notion-py-client
```

- Poetry

```bash
poetry add notion-py-client
```

# SDKé–‹ç™ºã®èƒŒæ™¯ï¼ˆãªãœHTTPç›´å©ãã§ã¯ãƒ€ãƒ¡ã ã£ãŸã®ã‹ï¼Ÿï¼‰

ã€ŒNotion APIã€Pythonã§ã‚‚HTTPå©ã‘ã°ä½¿ãˆã‚‹ã‚ˆã­ï¼Ÿã€  
å®Ÿéš›ã€ç§ã‚‚æœ€åˆã¯ requests + JSON ã§ååˆ†ã ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚

ã—ã‹ã—æ¥­å‹™ã§æœ¬æ ¼çš„ã«ä½¿ãŠã†ã¨ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªå•é¡Œã«ã™ãç›´é¢ã—ã¾ã™ï¼š

- properties ã®å‹å®šç¾©ï¼ˆTitle / Relation / Date / Formulaâ€¦ï¼‰ãŒå¤šãè¤‡é›‘  
- `page["properties"]["Title"]["title"][0]["plain_text"]` ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒä¹±ç«‹  
- ã©ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ nullable ãªã®ã‹æ¯å›ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ãªã‘ã‚Œã°ãªã‚‰ãªã„  
- APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å‹ãŒãªã„ã®ã§è£œå®Œã‚‚åŠ¹ã‹ãšã€typoã‚„KeyErrorã«æ°—ã¥ã‘ãªã„  

ã¤ã¾ã‚Šã€ŒSDKãŒãªã„ã€ã“ã¨è‡ªä½“ãŒå•é¡Œã§ã¯ãªãã€  
**ã€Œå‹æƒ…å ±ã®ãªã„ã¾ã¾Notion APIã‚’ä½¿ã†ã“ã¨ãŒæ¥­å‹™é–‹ç™ºã§ã¯ç ´ç¶»ã™ã‚‹ã€**  
ã¨æ„Ÿã˜ãŸã“ã¨ãŒå‡ºç™ºç‚¹ã§ã—ãŸã€‚

## Notion APIã®SDKã®ç¾çŠ¶
Notionã®APIã«å¯¾å¿œã—ãŸå…¬å¼ã®SDKã¯ç¾çŠ¶TypeScriptã§æ›¸ã‹ã‚ŒãŸ[notion-sdk-js](https://github.com/makenotion/notion-sdk-js)ã—ã‹å­˜åœ¨ã›ãšã€Pythonã§ã¯[notion_client](https://github.com/ramnes/notion-sdk-py)ã®ã‚ˆã†ãªéå…¬å¼ã®ã‚‚ã®ã¯ã‚ã‚‹ã‚‚ã®ã®ã€å…¬å¼ã®Python SDKã¯å­˜åœ¨ã—ãªã„ã¨ã„ã†ã®ãŒç¾çŠ¶ã§ã™ã€‚
æœ¬å½“ã¯TypeScriptã§é–‹ç™ºã‚’è¡Œã„ãŸã‹ã£ãŸã®ã§ã™ãŒã€ã‚·ã‚¹ãƒ†ãƒ ã‚’ä»–ã®ãƒ¡ãƒ³ãƒãƒ¼ã«å¼•ãç¶™ãè¦³ç‚¹ã‹ã‚‰Pythonã§ã®é–‹ç™ºãŒå¿…é ˆã¨ãªã£ã¦ã„ã¾ã—ãŸã€‚

## æ—¢å­˜ã®Python SDKï¼ˆnotion-clientï¼‰ã®ç«‹ã¡ä½ç½®ã¨é™ç•Œ
Pythonå‘ã‘ã«ã¯ `notion-client`ï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åï¼‰ã€`notion_client`ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆåï¼‰ã¨ã„ã†éå…¬å¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå­˜åœ¨ã—ã¾ã™ã€‚  
ãŸã ã—ã“ã‚Œã¯ã€ŒHTTPãƒ©ãƒƒãƒ‘ãƒ¼ã€ã¨ã—ã¦ã¯ä¾¿åˆ©ãªä¸€æ–¹ã§ã€æ¬¡ã®ã‚ˆã†ãªèª²é¡ŒãŒã‚ã‚Šã¾ã™ï¼š

| é …ç›® | å†…å®¹ |
|------|------|
| å‹æƒ…å ± | ã™ã¹ã¦ `dict[str, Any]` ã¨ã—ã¦è¿”ã•ã‚Œã‚‹ |
| è£œå®Œ | VS Codeãªã©ã§ã»ã¼åŠ¹ã‹ãªã„ |
| Propertyæ§‹é€ ã®çŸ¥è­˜ | é–‹ç™ºè€…ãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦è‡ªåŠ›ã§è§£é‡ˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ |
| APIè¿½å¾“ | TypeScriptç‰ˆã»ã©è¿…é€Ÿã§ã¯ãªã„ |

ã¤ã¾ã‚Šã€**ã€ŒHTTPã®é¢å€’ã‚’çœãã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ã‚ã‚‹ãŒã€ã€Œå‹å®‰å…¨ãªé–‹ç™ºä½“é¨“ã€ã‚’æä¾›ã™ã‚‹ SDK ã§ã¯ãªã„**ã¨è¨€ãˆã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/31ca83fc8210-20251104.png)

## å‹å®‰å…¨ã§æœ€æ–°ç‰ˆã®APIã«å¯¾å¿œã—ãŸSDKã®å¿…è¦æ€§
æœ¬æ¥SDKã¨ã¯ã€é–‹ç™ºè€…ã«ã¨ã£ã¦ã€APIä»•æ§˜ã«ã¤ã„ã¦è©³ç´°ã«èª¿ã¹ã‚‹ã“ã¨ãªãå¿…è¦ãªå‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹ãŸã‚ã®è£œåŠ©ã‚’è¡Œã†ã‚‚ã®ã§ã‚ã‚‹ã¨ç§ã¯è€ƒãˆã¦ã„ã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºè€…ã¯å¤–éƒ¨APIã¨ã®é€šä¿¡å‡¦ç†ã‚’ç°¡æ½”ã«è¨˜è¿°ã§ãã€æœ¬æ¥é›†ä¸­ã™ã‚‹ã¹ãç‚¹ã§ã‚ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ã«æ™‚é–“ã‚’å‰²ãã“ã¨ãŒã§ãã‚‹ã®ã ã¨æ€ã„ã¾ã™ã€‚
ã—ã‹ã—ã€ä»Šã®[notion_client](https://github.com/ramnes/notion-sdk-py)ã®ã‚ˆã†ãªSDKã§ã¯ã€ãã‚‚ãã‚‚Notionã®APIä»•æ§˜ã«ã¤ã„ã¦èª¿ã¹ã‚‹ã ã‘ã§å¤šå¤§ãªæ™‚é–“ã‚’è²»ã‚„ã—ã¦ã—ã¾ã„ã¾ã™ã€‚ã•ã‚‰ã«ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒæ•£ã‚‰ã°ã£ã¦ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ãŒéå¸¸ã«ä½ãã€ã©ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ã®ã‹è¦‹ã¦ã‚‚ã‚ã‹ã‚‰ãªã„ã‚³ãƒ¼ãƒ‰ãŒå®Œæˆã—ã¾ã™ã€‚ï¼ˆã“ã‚Œã¯Notionã®APIä»•æ§˜ã‚’AIã«ä¸ãˆã¦ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã›ãŸã¨ãã«é¡•è‘—ã«ç¾ã‚Œã¾ã™ï¼‰

```python
from pydantic import BaseModel
from notion_client import AsyncClient

notion = AsyncClient()

class Task(BaseModel):
    name: str
    due_date: str
    completed: bool

async def get_page(page_id: str) -> Task:
    page = await notion.pages.retrieve(page_id=page_id)
    # pageã®propertiesã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
    return Task(
        name=page["properties"]["Name"]["title"][0]["plain_text"],
        due_date=page["properties"]["Due Date"]["date"]["start"],
        completed=page["properties"]["Completed"]["checkbox"],
    )
```

AIã«ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã›ã‚‹ã«ã—ã¦ã‚‚ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒã©ã®ã‚ˆã†ãªæ§‹é€ ã‚’æŒã£ã¦ã„ã‚‹ã‹ã®å‹æƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã¯éå¸¸ã«é‡è¦ã ã¨è€ƒãˆã¦ã€SDKã®é–‹ç™ºã«è‡³ã‚Šã¾ã—ãŸã€‚
# notion-py-clientã®è¨­è¨ˆæ€æƒ³
ä»Šå›ç§ãŒã“ã®Notion SDKã‚’é–‹ç™ºã™ã‚‹ä¸Šã§æ„è­˜ã—ãŸç‚¹ã¯ä»¥ä¸‹ã®2ç‚¹ã§ã™ã€‚
1. ã§ãã‚‹é™ã‚Šå…¬å¼ã®TypeScript SDKã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹å‹ã‚’ã‚«ãƒãƒ¼ã™ã‚‹
2. Notionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’RDBã®ã‚ˆã†ã«æ‰±ã†ã“ã¨ãŒã§ãã‚‹ORMã¨ã—ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹

1ç‚¹ç›®ã«ã¤ã„ã¦ã¯GitHub Copilotã‚„Claudeãªã©ã®AIã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ”¯æ´ãƒ„ãƒ¼ãƒ«ã‚’æ´»ç”¨ã—ã¦ã€TypeScriptå…¬å¼SDKã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ã•ã›ã‚‹ã“ã¨ã§åŠ¹ç‡çš„ã«å‹å®šç¾©ã‚’é€²ã‚ã¾ã—ãŸã€‚
2ç‚¹ç›®ã«ã¤ã„ã¦ã¯ã€SDKã¨ã—ã¦ã®æ©Ÿèƒ½ã‚’é‚ªé­”ã—ãªã„ã‚ˆã†ã«ã€è–„ã„ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã¨ã—ã¦ORMæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€å˜ã«SDKã¨ã—ã¦ä½¿ã„ãŸã„é–‹ç™ºè€…ã€Notionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’RDBã®ã‚ˆã†ã«æ‰±ã„ãŸã„é–‹ç™ºè€…ã©ã¡ã‚‰ã‚‚ãŒä½¿ã„ã‚„ã™ã„SDKã¨ãªã‚‹ã‚ˆã†ã«å¿ƒãŒã‘ã¾ã—ãŸã€‚

# notion-py-clientã®å°å…¥ã«ã‚ˆã‚‹é–‹ç™ºä½“é¨“ã®å‘ä¸Š

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°å…¥ã«ã‚ˆã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ç°¡æ½”ã«ãªã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…ã®ãŸã‚ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã—ãŸã€‚

## TypeScriptäº’æ›ã®å‹è£œå®Œã«ã‚ˆã‚‹é–‹ç™ºè€…ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªé–‹ç™ºä½“é¨“

ã¾ãšã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ãŒæ˜ç¢ºã«å®šç¾©ã•ã‚Œã‚‹ã“ã¨ã§ã€APIã®è©³ç´°ãªä»•æ§˜ã‚’çŸ¥ã‚‹ã“ã¨ãªãã€å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨˜è¿°ã—ã¦ã€å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹å‡¦ç†ã‚’ç°¡æ½”ã«è¨˜è¿°ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```python
from notion_py_client import NotionAsyncClient
from notion_py_client.guards import is_full_page

notion_client = NotionAsyncClient(auth="fake_api_key")

response = await notion_client.dataSources.query(
    data_source_id="fake_datasource_id",
    page_size=1,
    filter={
        "property": "Status",
        "select": {"equals": "Active"},
    },
)
for result in response.results:
    # resultã«ã‚‚å‹ãŒã¤ã
    if is_full_page(result):
        for item in result.properties.values():
            if item.type == "relation":
                # Type Guardã«ã‚ˆã‚Šã€RelationPropertyã®å‹ã«çµã‚Šè¾¼ã¾ã‚Œã‚‹
                relation_ids = [rel.id for rel in item.relation] # relationãŒlistå½¢å¼ã§ã‚ã‚‹ã“ã¨ã‚’çŸ¥ã‚‰ãªãã¦ã‚‚è¨˜è¿°ã§ãã‚‹
            elif item.type == "people":
                # Type Guardã«ã‚ˆã‚Šã€PeoplePropertyã®å‹ã«çµã‚Šè¾¼ã¾ã‚Œã‚‹
                people = [person.id for person in item.people]
```

## ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã«ã‚ˆã‚‹ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã¨ORMã¨ã—ã¦ã®åˆ©ç”¨

SDKã¨ã—ã¦ã®åˆ©ç”¨ã‚’å¦¨ã’ãªã„ç¨‹åº¦ã®è–„ã„ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€Notionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã—ã¦ã€ãã®ORMã¨ã—ã¦ã®æ©Ÿèƒ½ã‚’ç°¡å˜ã«å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

:::details ãƒãƒƒãƒ‘ãƒ¼ã®å®Ÿè£…ã®è©³ç´°ã‚’è¦‹ã‚‹
```python:mapper.py
from notion_py_client.helper import NotionMapper, NotionPropertyDescriptor, Field
from notion_py_client.properties import (
    RelationProperty,
    SelectProperty,
    FormulaProperty,
    NumberProperty,
    DateProperty,
    TitleProperty,
    MultiSelectProperty,
    PeopleProperty,
    EmailProperty,
    NotionPropertyType,
)
from src.domain.entities import EnterpriseResource

# Domain Modelã‚’genericsã§å—ã‘å–ã‚‹ã“ã¨ã§å‹è£œå®ŒãŒåŠ¹ã„ãŸMapperã«ãªã‚‹
class EnterpriseResourceNotionMapper(NotionMapper[EnterpriseResource]):
    assignee_field: NotionPropertyDescriptor[
        PeopleProperty, PeoplePropertyRequest, str | None
    ] = Field(
        notion_name="Assignee",
        parser=lambda p: p.people[0].id if len(p.people) > 0 else None,
    )
    date_range_field: NotionPropertyDescriptor[
        DateProperty, DatePropertyRequest, DateRange
    ] = Field(
        notion_name="DateRange",
        parser=lambda p: DateRange(
            start_date=p.get_start_date(),
            end_date=p.get_end_date(),
            time_zone=p.date.time_zone if p.date and p.date.time_zone else None,
        ),
        request_builder=lambda v: DatePropertyRequest(
            date=DateRequest(
                start=v.start_date.isoformat(),
                end=v.end_date.isoformat(),
                time_zone=v.time_zone if v.time_zone else None,
            )
        ),
    )
    project_range_field: NotionPropertyDescriptor[
        MultiSelectProperty, MultiSelectPropertyRequest, list[str]
    ] = Field(
        notion_name="ProjectRange",
        parser=lambda p: (
            [select.name for select in p.multi_select]
            if len(p.multi_select) > 0
            else []
        ),
        request_builder=lambda v: MultiSelectPropertyRequest(
            multi_select=[SelectPropertyItemRequest(name=name) for name in v]
        ),
    )

    def to_domain(self, notion_page: NotionPage) -> EnterpriseResource:
        props = notion_page.properties
        assignee_prop = props[self.assignee_field.notion_name]
        if not assignee_prop.type == "people":
            raise ValueError("Assignee is missing")
        date_range_prop = props[self.date_range_field.notion_name]
        if not date_range_prop.type == "date":
            raise ValueError("Date Range is missing")
        project_range_prop = props[self.project_range_field.notion_name]
        if not project_range_prop.type == "multi_select":
            raise ValueError("Project Range is missing")

        return EnterpriseResource(
            id=notion_page.id,
            assignee=self.assignee_field.parse(assignee_prop),
            date_range=self.date_range_field.parse(date_range_prop),
            project_range=self.project_range_field.parse(project_range_prop),
        )

    def build_create_properties(
        self, data_source_id: str, model: EnterpriseResource
    ) -> CreatePageParameters:
        ...

    def build_update_properties(
        self, model: EnterpriseResource
    ) -> UpdatePageParameters:
        ...

    def build_update_project_range_properties(
        self, id: str, project_range: list[str]
    ) -> UpdatePageParameters:
        return UpdatePageParameters(
            page_id=id,
            properties={
                self.project_range_field.notion_name: self.project_range_field.build_request(
                    project_range
                ),
            },
        )
```
:::

## Notionãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®pandasãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã¸ã®ã‚¹ãƒ ãƒ¼ã‚ºãªå¤‰æ›

æ—¢å­˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ãã‚Œãã‚Œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã”ã¨ã«ãƒ‘ãƒ¼ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨˜è¿°ã—ã¦ã€ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¶²ç¾…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€ã“ã®å‹å®šç¾©ã‚„parseãƒ­ã‚¸ãƒƒã‚¯ã‚’SDKåŒ–ã™ã‚‹ã“ã¨ã§ä»¥ä¸‹ã®ã‚ˆã†ã«éå¸¸ã«ç°¡æ½”ãªã‚³ãƒ¼ãƒ‰ã§pandasãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã¸ã¨å¤‰æ›ã§ãã¾ã™ã€‚

:::details pandasã¸ã®å¤‰æ›ã‚³ãƒ¼ãƒ‰
```python
from logging import getLogger

import pandas as pd
from notion_py_client import NotionAsyncClient
from notion_py_client.responses.page import NotionPage
from notion_py_client.utils import is_full_page
from notion_py_client.properties import NotionPropertyType

# æŠ½è±¡ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ˆã‚‹ç–çµåˆã®å®Ÿç¾
from src.core.domain.repositories import INotionDatabaseRepository


class NotionDatabaseRepository(INotionDatabaseRepository):
    def __init__(self, notion_client: NotionAsyncClient):
        self._notion_client = notion_client
        self._logger = getLogger(__name__)

    async def get_all_records(self, data_source_id: str) -> pd.DataFrame:
        self._logger.info(f"Getting all records from data source: {data_source_id}")
        next_cursor = None
        valid_records: list[NotionPage] = []
        all_records_count = 0
        while True:
            response = await self._notion_client.dataSources.query(
                data_source_id=data_source_id,
                start_cursor=next_cursor,
            )
            all_records_count += len(response.results)
            for record in response.results:
                if record.object != "page":
                    self._logger.warning(
                        f"Skipping non-page object in data source: {record.object}"
                    )
                    continue
                if is_full_page(record):
                    valid_records.append(record)
                else:
                    self._logger.warning(
                        f"Skipping partial page in data source: {record.id}"
                    )
            if not response.has_more:
                break
            next_cursor = response.next_cursor
        self._logger.info(f"Valid records: {len(valid_records)}/{all_records_count}")

        # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã‚’å–å¾—ã—ã¦DataFrameã«å¤‰æ›
        data = []
        for record in valid_records:
            row = {}
            row["id"] = record.id
            for key, property_obj in record.properties.items():
                # get_display_valueã§Notionãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã§ã®propertyã®è¡¨ç¤ºå€¤ã‚’å–å¾—ã§ãã‚‹
                row[key] = property_obj.get_display_value()
            data.append(row)

        # DataFrameã«å¤‰æ›
        df = pd.DataFrame(data)
        self._logger.info(f"Created DataFrame with shape: {df.shape}")
        return df
```
:::

ã“ã‚Œã‚‰ã®ä½¿ã„æ–¹ã®è©³ç´°ã«ã¤ã„ã¦ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

https://higashi-masafumi.github.io/notion-py/

# ä½œã£ã¦ã¿ã¦æ°—ã¥ã„ãŸNotion APIã®ã‚¯ã‚»

ã¨ã«ã‹ãNotion APIã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¯Nullableã‚’å¤šåˆ†ã«å«ã¿ã€æ·±ããƒã‚¹ãƒˆã—ãŸJSONå½¢å¼ã§ã‚ã‚Šã€é–‹ç™ºè€…ã«ã¨ã£ã¦ã“ã®æ·±ããƒã‚¹ãƒˆã—ãŸJSONæ§‹é€ ã‚’èªè­˜ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã¯éå¸¸ã«ç„¡é§„ãªã‚³ã‚¹ãƒˆã§ã‚ã‚Šã€ã“ã“ã‚’SDKã«ã‚ˆã£ã¦ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã¯åŠ¹ç‡çš„ãªé–‹ç™ºã‚’é€²ã‚ã‚‹ã«ã‚ãŸã£ã¦éå¸¸ã«æœ‰æ„ç¾©ã§ã‚ã‚‹ã¨æ„Ÿã˜ã¾ã—ãŸã€‚
ã¾ãŸã€Notion APIã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã¨ãã®JSONæ§‹é€ ã‚‚éå¸¸ã«è¤‡é›‘ã§ã‚ã‚Šã€ã“ã‚Œã‚‰ã‚’1ã‹ã‚‰èª¿ã¹ã¦é–‹ç™ºè€…ãŒJSONã‚’æ›¸ãã®ã§ã¯ãªãã€SDKã«ã‚ˆã£ã¦ã©ã‚“ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒæŒ‡å®šã§ãã‚‹ã®ã‹ã‚’APIä»•æ§˜ã‚’èª¿ã¹ã‚‹ã“ã¨ãªãçŸ¥ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã¯éå¸¸ã«å¤§ããªãƒ¡ãƒªãƒƒãƒˆã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

:::details ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¸€ä¾‹
```json
{
  "object": "data_source",
  "id": "bc1211ca-e3f1-4939-ae34-5260b16f627c",
  "created_time": "2021-07-08T23:50:00.000Z",
  "last_edited_time": "2021-07-08T23:50:00.000Z",
  "properties": {
    "+1": {
      "id": "Wp%3DC",
      "name": "+1",
      "type": "people",
      "people": {}
    },
    "In stock": {
      "id": "fk%5EY",
      "name": "In stock",
      "type": "checkbox",
      "checkbox": {}
    },
    "Price": {
      "id": "evWq",
      "name": "Price",
      "type": "number",
      "number": {
        "format": "dollar"
      }
    },
    "Description": {
      "id": "V}lX",
      "name": "Description",
      "type": "rich_text",
      "rich_text": {}
    },
    "Last ordered": {
      "id": "eVnV",
      "name": "Last ordered",
      "type": "date",
      "date": {}
    },
    "Meals": {
      "id": "%7DWA~",
      "name": "Meals",
      "type": "relation",
      "relation": {
        "database_id": "668d797c-76fa-4934-9b05-ad288df2d136",
        "synced_property_name": "Related to Grocery List (Meals)"
      }
    },
    "Number of meals": {
      "id": "Z\\Eh",
      "name": "Number of meals",
      "type": "rollup",
      "rollup": {
        "rollup_property_name": "Name",
        "relation_property_name": "Meals",
        "rollup_property_id": "title",
        "relation_property_id": "mxp^",
        "function": "count"
      }
    },
    "Store availability": {
      "id": "s}Kq",
      "name": "Store availability",
      "type": "multi_select",
      "multi_select": {
        "options": [
          {
            "id": "cb79b393-d1c1-4528-b517-c450859de766",
            "name": "Duc Loi Market",
            "color": "blue"
          },
          {
            "id": "58aae162-75d4-403b-a793-3bc7308e4cd2",
            "name": "Rainbow Grocery",
            "color": "gray"
          },
          {
            "id": "22d0f199-babc-44ff-bd80-a9eae3e3fcbf",
            "name": "Nijiya Market",
            "color": "purple"
          },
          {
            "id": "0d069987-ffb0-4347-bde2-8e4068003dbc",
            "name": "Gus's Community Market",
            "color": "yellow"
          }
        ]
      }
    },
    "Photo": {
      "id": "yfiK",
      "name": "Photo",
      "type": "files",
      "files": {}
    },
    "Food group": {
      "id": "CM%3EH",
      "name": "Food group",
      "type": "select",
      "select": {
        "options": [
          {
            "id": "6d4523fa-88cb-4ffd-9364-1e39d0f4e566",
            "name": "ğŸ¥¦Vegetable",
            "color": "green"
          },
          {
            "id": "268d7e75-de8f-4c4b-8b9d-de0f97021833",
            "name": "ğŸFruit",
            "color": "red"
          },
          {
            "id": "1b234a00-dc97-489c-b987-829264cfdfef",
            "name": "ğŸ’ªProtein",
            "color": "yellow"
          }
        ]
      }
    },
    "Name": {
      "id": "title",
      "name": "Name",
      "type": "title",
      "title": {}
    }
  },
  "parent": {
    "type": "database_id",
    "database_id": "6ee911d9-189c-4844-93e8-260c1438b6e4"
  },
  "database_parent": {
    "type": "page_id",
    "page_id": "98ad959b-2b6a-4774-80ee-00246fb0ea9b"
  },
  "archived": false,
  "is_inline": false,
  "icon": {
    "type": "emoji",
    "emoji": "ğŸ‰"
  },
  "cover": {
    "type": "external",
    "external": {
      "url": "https://website.domain/images/image.png"
    }
  },
  "url": "https://www.notion.so/bc1211cae3f14939ae34260b16f627c",
  "title": [
    {
      "type": "text",
      "text": {
        "content": "Grocery List",
        "link": null
      },
      "annotations": {
        "bold": false,
        "italic": false,
        "strikethrough": false,
        "underline": false,
        "code": false,
        "color": "default"
      },
      "plain_text": "Grocery List",
      "href": null
    }
  ]
}
```
:::

# ä»Šå¾Œã®å±•æœ›

Notion APIã¯æ—¥ã€…é€²åŒ–ã—ã¦ã„ã¾ã™ã€‚ä»Šå¹´ã‚‚[Data sources](https://www.notion.com/ja/help/data-sources-and-linked-databases)ã¨ã„ã†æ–°ã—ã„æ¦‚å¿µã®å°å…¥ã«ã‚ˆã‚Šã€APIã®ä»•æ§˜ã¯å¤§ããå¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚

https://developers.notion.com/docs/upgrade-guide-2025-09-03

ä»Šå¾Œã¯ã“ã®ã‚ˆã†ãªNotion APIã®å®šæœŸçš„ãªã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ç›£è¦–ã—ã¦ã€SDKã‚’ç¶™ç¶šçš„ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ã„ãä»•çµ„ã¿ã¥ãã‚Šã‚„ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’ç™ºå±•ã•ã›ã¦ãƒã‚°ãªã©ã‚’è§£æ¶ˆã—ã¦ã„ããŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
